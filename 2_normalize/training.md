# 例題

## 問題 1

受注入力システムによって作成される次の表に関する説明のうち、適切なものはどれか？

受注番号は受注ごとに新たに発行される番号であり、項番は 1 回の受注で商品コード別に連番で発行される番号である。

なお、単価は商品コードによって一意に定まる。

| 受注日     | 受注番号 | 得意先コード | 項番 | 商品コード | 数量 | 単価   |
| ---------- | -------- | ------------ | ---- | ---------- | ---- | ------ |
| 2015-03-05 | 995867   | 0256         | 1    | 20121      | 20   | 20,000 |
| 2015-03-05 | 995867   | 0256         | 2    | 24005      | 10   | 15,000 |
| 2015-03-05 | 995867   | 0256         | 3    | 28007      | 5    | 5,000  |

### 選択肢

1. 正規化は行われていない

2. 第１正規形までされている

3. 第２正規形まで正規化されている

4. 第３正規形まで正規化されている

### memo

- 条件

  - 受注番号は受注ごとに新たに発行される番号：受注ごとに一意

  - 項番は 1 回の受注で商品コード別に連番で発行される番号：「項番 → 商品コード」の関数従属性

  - 単価は商品コードによって一意に定まる：「項番 → 商品コード → 単価」の関数従属性

- 候補キーの列挙：{受注番号, 項番}

- 非キー属性の列挙：{受注日, 得意先コード}

- 候補キーと非キー属性との間に完全関数従属の関係があるかを検査

  1. {受注番号, 項番} → {受注日}

     - {受注番号} → {受注日}：受注番号によって受注日は決まるので、成立する

     - {項番} → {受注日}：項番によって受注日は決まらないので、成立しない

  2. {受注番号, 項番} → {得意先コード}

     - {受注番号} → {得意先コード}：受注番号によって得意先コードは決まるので、成立する

     - {項番} → {得意先コード}：項番によって得意先コードは決まらないので、成立しない

- 部分関数従属排除後のリレーション

  - 表１（受注番号, 受注日）

  - 表 2（受注番号, 項番, 商品コード, 単価）

  - 表 3（受注番号, 得意先コード）

### 解説

- 候補キー：`{受注番号, 項番}, {受注番号, 商品コード}`

- 非キー属性：`"受注日", "得意先コード", "数量", "単価"`

  ```
  memo

  ・ 自分で解いた時は "単価" は "商品コード" が決まると自動で決まるというところで、候補キーに含めてしまっていた

  ・ 今一度候補キーが何なのかをおさらいすると **タプルを一意に定める「極小」の組** である

  ・その上で考えると {受注番号, 単価} が一意でないことはすぐにわかる。私は雰囲気で候補キーを決めていた。気をつける
  ```

- 候補キーの真部分集合に関数従属している関係があるかを検査

  - `{受注番号} → {受注日, 得意先コード}`

  - `{商品コード} → {単価}`

  ```
  memo

  ・{受注番号} → {受注日}／{受注番号} → {得意先コード} が関数従属していることが成立しているところまではできていた

  ・上記は別々のリレーションじゃなくて、1つのリレーションに移動するのがわかっていなかった。つまり、{受注番号} → {受注日, 得意先コード} が正解

  ・単価はそもそも非キー属性に入れられてなかったので、{商品コード} → {単価} は出せていなかった
  ```
