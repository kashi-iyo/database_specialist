# 例題

- [問題 1](#問題-1)

## 問題 1

受注入力システムによって作成される次の表に関する説明のうち、適切なものはどれか？

受注番号は受注ごとに新たに発行される番号であり、項番は 1 回の受注で商品コード別に連番で発行される番号である。

なお、単価は商品コードによって一意に定まる。

| 受注日     | 受注番号 | 得意先コード | 項番 | 商品コード | 数量 | 単価   |
| ---------- | -------- | ------------ | ---- | ---------- | ---- | ------ |
| 2015-03-05 | 995867   | 0256         | 1    | 20121      | 20   | 20,000 |
| 2015-03-05 | 995867   | 0256         | 2    | 24005      | 10   | 15,000 |
| 2015-03-05 | 995867   | 0256         | 3    | 28007      | 5    | 5,000  |

### 選択肢

1. 正規化は行われていない

2. 第１正規形までされている

3. 第２正規形まで正規化されている

4. 第３正規形まで正規化されている

### memo

- 条件

  - 受注番号は受注ごとに新たに発行される番号：受注ごとに一意

  - 項番は 1 回の受注で商品コード別に連番で発行される番号：「項番 → 商品コード」の関数従属性

  - 単価は商品コードによって一意に定まる：「項番 → 商品コード → 単価」の関数従属性

- 候補キーの列挙：{受注番号, 項番}

- 非キー属性の列挙：{受注日, 得意先コード}

- 候補キーと非キー属性との間に完全関数従属の関係があるかを検査

  1. {受注番号, 項番} → {受注日}

     - {受注番号} → {受注日}：受注番号によって受注日は決まるので、成立する

     - {項番} → {受注日}：項番によって受注日は決まらないので、成立しない

  2. {受注番号, 項番} → {得意先コード}

     - {受注番号} → {得意先コード}：受注番号によって得意先コードは決まるので、成立する

     - {項番} → {得意先コード}：項番によって得意先コードは決まらないので、成立しない

- 部分関数従属排除後のリレーション

  - 表１（受注番号, 受注日）

  - 表 2（受注番号, 項番, 商品コード, 単価）

  - 表 3（受注番号, 得意先コード）

### 解説

- 候補キー：`{受注番号, 項番}, {受注番号, 商品コード}`

- 非キー属性：`"受注日", "得意先コード", "数量", "単価"`

  ```
  memo

  ・ 自分で解いた時は "単価" は "商品コード" が決まると自動で決まるというところで、候補キーに含めてしまっていた

  ・ 今一度候補キーが何なのかをおさらいすると **タプルを一意に定める「極小」の組** である

  ・その上で考えると {受注番号, 単価} が一意でないことはすぐにわかる。私は雰囲気で候補キーを決めていた。気をつける
  ```

- 候補キーの真部分集合に関数従属している関係があるかを検査

  - `{受注番号} → {受注日, 得意先コード}`

  - `{商品コード} → {単価}`

  ```
  memo

  ・{受注番号} → {受注日}／{受注番号} → {得意先コード} が関数従属していることが成立しているところまではできていた

  ・上記は別々のリレーションじゃなくて、1つのリレーションに移動するのがわかっていなかった。つまり、{受注番号} → {受注日, 得意先コード} が正解

  ・単価はそもそも非キー属性に入れられてなかったので、{商品コード} → {単価} は出せていなかった
  ```

## 問題 2

第２正規形だが、第３正規形ではない表はどれか。

### 条件

- 講義名に対して担当教員は一意に決まる

- 所属コードに対して勤務地は一意に決まる

- {} は繰り返し項目を表している

- 実線の下線は主キー

### 選択肢

- ア

  | <ins>学生番号</ins> | <ins>講義名</ins> | 担当教員 | 成績 |
  | ------------------- | ----------------- | -------- | ---- |
  | 2122                | 経済学            | 山田教授 | 優   |

- イ

  | <ins>社員番号</ins> | 氏名     | 入社年月日 | 電話番号     |
  | ------------------- | -------- | ---------- | ------------ |
  | 71325               | 山田太郎 | 2001-04-01 | 03-1234-5678 |

- ウ

  | <ins>社員番号</ins> | 氏名   | 所属コード | 勤務地 |
  | ------------------- | ------ | ---------- | ------ |
  | 15547               | 小林明 | 75T        | 東京   |

- エ

  | <ins>社員番号</ins> | 身長 | 体重 | 趣味             |
  | ------------------- | ---- | ---- | ---------------- |
  | 71234               | 170  | 62   | {テニス, ゴルフ} |

### memo

#### ア

- 第１正規形はクリアしてるか？

  - **すべて単一値なのでクリアしてる**

- 第２正規形はクリアしてるか？

  - 部分関数従属を廃せているかを検査する

  - 候補キー列挙

    - {学生番号, 講義名}, {学生番号, 担当教員}

  - 非キー属性列挙

    - "成績"

  - 部分関数従属の関係があるかどうかを検査

    - {学生番号, 講義名} → "成績"

      - {学生番号} → "成績"

        - 学生番号が決まっても成績が決まるわけではないので、関数従属は成立しない

      - {講義名} → "成績"

        - 講義名が決まっても成績は決まらないので、関数従属は成立しない

    - {学生番号, 担当教員} → "成績"

      - {学生番号} → "成績"

        - 学生番号が決まっても成績が決まるわけではないので、関数従属は成立しない

      - {担当教員} → "成績"

        - 担当教員が決まっても成績は決まらないので、関数従属は成立しない

    - 結果

      - 部分関数従属は存在しないので、完全関数従属が成立している

  - **第１正規形でありかつ、候補キーに対する非キー属性が完全関数従属しているので、第２正規形をクリアしている**

- 第３正規形はクリアしているのか

  - 推移的関数従属を廃せているかを検査する

  - X→Y→Z に当てはめられる関数従属性がないので、第３正規形はクリアしてそう？

#### イ

- 第１正規形はクリアしてる？

  - **すべて単一値なのでクリアしてる**

- 第２正規形はクリアしてる？

  - 部分関数従属を廃せているかを検査する

  - 候補キー列挙

    - {社員番号}

  - 非キー属性

    - 氏名、入社年月日、電話番号

  - 完全関数従属が成立しているかどうか

    - {社員番号} → 氏名

      - 成立する

    - {社員番号} → 入社年月日

      - 成立する

    - {社員番号} → 電話番号

      - 成立する

  - 結果

    - 部分関数従属は廃せていないので、第２正規形ではない

#### ウ

- 第１正規形はクリアしてる？

  - **すべて単一値なのでクリアしてる**

- 第２正規形はクリアしてる？

  - 部分関数従属を廃せているかを検査する

  - 候補キー列挙

    - {社員番号}

  - 非キー属性

    - 氏名、所属コード、勤務地

  - 完全関数従属が成立しているかどうか

    - {社員番号} → 氏名：成立

    - {社員番号} → 所属コード：成立しない

    - {社員番号} → 勤務地：成立しない

  - 結果

    - 部分関数従属を廃せてないので、第２正規形ではない

#### エ

- 第１正規形はクリアしてる？

  - 趣味が単一値になっていないので成立しない

### 解説

- 講義名に対して担当教員は一意に決まるので、{講義名} → {担当教員}

- 所属コードに対して勤務地は一意に決まるので、{所属コード} → {勤務地}

- ア

  - 候補キーは {学生番号, 講義名} で、{講義名} → {担当教員} の関数従属性があり、候補キー {講義名} と非キー属性 {担当教員} が部分関数従属性が存在していることになる。よって、第１正規形ではあるが、第２正規形ではない。

  - {学生番号, 担当教員} タプルは極小かつ一意に識別できると思った、担当教員は非キー属性じゃないんか？

- イ

  - 候補キーは {社員番号} で、候補キーの真部分集合はないので、少なくとも第２正規形。また、推移的関数従属性も存在しないので、第３正規形

- ウ

  - 候補キーは {社員番号} で、候補キーの真部分集合はないので、少なくとも第２正規形。{所属コード} → {勤務地} という関数従属性があるので、候補キー {社員番号} に対して {社員番号} → {所属コード} → {勤務地} という推移的関数従属性が存在する。したがって第３正規形ではなく、第２正規形。

- エ

  - 単一値じゃないので第１正規形ではない
