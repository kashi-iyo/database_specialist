# 正規化の練習

- 次の「伝票」関係（リレーション）を用いて正規化を行っていく。

  | 伝票番号 | 顧客名（顧客番号） | 商品番号     | 商品名                                      | 数量         |
  | -------- | ------------------ | ------------ | ------------------------------------------- | ------------ |
  | 1001     | ねこ商事（11）     | 2001<br>2002 | チョコレート<br>キャラメル                  | 5<br>10      |
  | 1002     | うさぎ開発（13）   | 2001         | チョコレート<br> ドーナツ<br>シュークリーム | 5<br>20<br>5 |
  | 1003     | くま工業（29）     | 2005         | プロテイン                                  | 30           |
  | 1004     | くま工業（29）     | 2005         | プロテイン                                  | 30           |

- 条件

  - 顧客は複数回注文するので、伝票は複数ある

  - 顧客番号に対応する顧客名の重複はない

  - 商品番号に対応する商品名の重複はない

## 第１正規形にする

- [ゴール](#ゴール)
- [方法](#方法)
- [ドメインから直積集合を排除する](#ドメインから直積集合を排除する)
- [ドメインから冪集合を排除する](#ドメインから冪集合を排除する)
- [候補キーを選択](#候補キーを選択)
- [主キーを選択](#主キーを選択)

### ゴール

すべてのドメインをシンプルにする

### 方法

- ドメインから **直積集合** を排除する

- ドメインから **冪集合** を排除する

- **候補キー** を決定する

- **主キー** を決定する

### ドメインから直積集合を排除する

**顧客名（顧客番号）** が直積集合なので、こいつを分解して、次のような関係（リレーション）にする

| 伝票番号 | 顧客名     | 顧客番号 | 商品番号     | 商品名                                      | 数量         |
| -------- | ---------- | -------- | ------------ | ------------------------------------------- | ------------ |
| 1001     | ねこ商事   | 11       | 2001<br>2002 | チョコレート<br>キャラメル                  | 5<br>10      |
| 1002     | うさぎ開発 | 13       | 2001         | チョコレート<br> ドーナツ<br>シュークリーム | 5<br>20<br>5 |
| 1003     | くま工業   | 29       | 2005         | プロテイン                                  | 30           |
| 1004     | くま工業   | 29       | 2005         | プロテイン                                  | 30           |

### ドメインから冪集合を排除する

複数の値を持っているドメインは「商品番号」「商品名」「数量」なので、こいつらを分解して、次のような関係（リレーション）にする

| 伝票番号 | 顧客番号 | 顧客名     | 商品番号 | 商品名         | 数量 |
| -------- | -------- | ---------- | -------- | -------------- | ---- |
| 1001     | 11       | ねこ商事   | 2001     | チョコレート   | 5    |
| 1001     | 11       | ねこ商事   | 2002     | キャラメル     | 10   |
| 1002     | 13       | うさぎ開発 | 2001     | チョコレート   | 5    |
| 1002     | 13       | うさぎ開発 | 2003     | ドーナツ       | 20   |
| 1002     | 13       | うさぎ開発 | 2004     | シュークリーム | 5    |
| 1003     | 29       | くま工業   | 2005     | プロテイン     | 30   |
| 1004     | 29       | くま工業   | 2005     | プロテイン     | 30   |

### 候補キーを選択

- **関係（リレーション）のタプルを一意に識別** できる属性

  - `{伝票番号, 顧客番号, 顧客名, 商品番号, 商品名, 数量}` の全ての属性

  - 値が全部同一のタプルがないので

- 属性の組のうち **極小** の属性

  - `{伝票番号, 顧客番号, 顧客名, 商品番号, 商品名, 数量}` からどれが取り除けそうか見ていく

    - `{伝票番号}`：欠落すると一意な組がなくなるので残し
    - `{顧客番号}`：欠落しても問題ないので消し
    - `{顧客名}`：欠落しても問題ないので消し
    - `{商品番号}`：欠落すると一意な組がなくなるので残し
    - `{商品名}`：欠落しても問題ないので消し
    - `{数量}`：欠落しても問題ないので消し

  - 結果、`{伝票番号, 商品番号}` が残り、これが候補キーの 1 つになる

### 主キー選択

- 候補キーの中から以下の 2 つの制約に合致する属性を選択する

  1. 主キーはタプルの一意識別能力を備えていること

  2. 主キーを構成する属性は空値（NULL）を取らないこと

- 列挙された候補キーは `{伝票番号, 商品番号}` のみ。この 2 つのいづれかになる。どちらでもいい

## 第２正規形にする

- [前提](#前提)
- [ゴール](#ゴール)
- [方法](#方法)
- [ドメインから直積集合を排除する](#ドメインから直積集合を排除する)
- [ドメインから冪集合を排除する](#ドメインから冪集合を排除する)
- [候補キーを選択](#候補キーを選択)
- [主キーを選択](#主キーを選択)

### 前提

- 第１正規形にした「伝票」関係（リレーション）を用いる

  | 伝票番号 | 顧客番号 | 顧客名     | 商品番号 | 商品名         | 数量 |
  | -------- | -------- | ---------- | -------- | -------------- | ---- |
  | 1001     | 11       | ねこ商事   | 2001     | チョコレート   | 5    |
  | 1001     | 11       | ねこ商事   | 2002     | キャラメル     | 10   |
  | 1002     | 13       | うさぎ開発 | 2001     | チョコレート   | 5    |
  | 1002     | 13       | うさぎ開発 | 2003     | ドーナツ       | 20   |
  | 1002     | 13       | うさぎ開発 | 2004     | シュークリーム | 5    |
  | 1003     | 29       | くま工業   | 2005     | プロテイン     | 30   |
  | 1004     | 29       | くま工業   | 2005     | プロテイン     | 30   |
